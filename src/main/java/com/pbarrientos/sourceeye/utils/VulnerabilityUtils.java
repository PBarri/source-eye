package com.pbarrientos.sourceeye.utils;

import java.util.HashSet;
import java.util.Set;
import java.util.stream.Collectors;

import org.apache.commons.collections.CollectionUtils;
import org.owasp.dependencycheck.dependency.Dependency;

import com.pbarrientos.sourceeye.data.model.Vulnerability;

/**
 * Utility class that provides methods for managing Vulnerabilities.
 *
 * @author Pablo Barrientos
 */
public class VulnerabilityUtils {

    private VulnerabilityUtils() {
    }

    /**
     * Returns a collection of vulnerabilities from a dependency
     * 
     * @param dependency the dependency
     * @return the dependency vulnerabilities
     * @since 0.1.0
     */
    public static Set<Vulnerability> mapDependencyVulnerabilities(final Dependency dependency) {
        Set<Vulnerability> vulns = new HashSet<>();

        if (!CollectionUtils.isEmpty(dependency.getVulnerabilities())) {
            vulns = dependency.getVulnerabilities().stream().map(v -> {
                Vulnerability vuln = new Vulnerability();
                vuln.setCve(v.getName());
                vuln.setCwe(v.getCwe());
                vuln.setCvssAccessComplexity(v.getCvssAccessComplexity());
                vuln.setCvssAccessVector(v.getCvssAccessVector());
                vuln.setCvssAuthentication(v.getCvssAuthentication());
                vuln.setCvssAvailabilityImpact(v.getCvssAvailabilityImpact());
                vuln.setCvssConfidentialityImpact(v.getCvssConfidentialityImpact());
                vuln.setCvssIntegrityImpact(v.getCvssIntegrityImpact());
                vuln.setCvssScore(v.getCvssScore());
                vuln.setDescription(v.getDescription());
                vuln.setMatchedAllPreviousCPE(v.getMatchedAllPreviousCPE());
                vuln.setMatchedCPE(v.getMatchedCPE());
                vuln.setNotes(v.getNotes());
                vuln.setUnscoredSeverity(v.getUnscoredSeverity());
                vuln.setName(v.getName());
                return vuln;
            }).collect(Collectors.toSet());
        }

        return vulns;
    }

}
