package com.pbarrientos.sourceeye.data.model;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.JoinColumn;
import javax.persistence.ManyToOne;
import javax.persistence.Table;

import com.fasterxml.jackson.annotation.JsonBackReference;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;

/**
 * The entity that maps the vulnerabilities discovered
 *
 * @author Pablo Barrientos
 */
@Entity
@Table(name = "se_vulnerabilities")
@ApiModel("Vulnerability")
public class Vulnerability extends BaseEntity {

    private static final long serialVersionUID = 1L;

    /**
     * The CVE assigned to that vulnerability
     */
    @ApiModelProperty(value = "The vulnerability CVE", required = true)
    @Column(nullable = false)
    private String cve;

    /**
     * The name assigned to that vulnerability
     */
    @ApiModelProperty(value = "The vulnerability name. Equals to CVE", required = true)
    @Column(nullable = false)
    private String name;

    /**
     * The description of the vulnerability
     */
    @ApiModelProperty(value = "The vulnerability description", required = false)
    private String description;

    /**
     * The CWE of the vulnerability
     */
    @ApiModelProperty(value = "The vulnerability cwe indicating the type of the vulnerability", required = false)
    private String cwe;

    /**
     * The unscored severity
     */
    @ApiModelProperty(value = "The vulnerability severity", required = false)
    private String unscoredSeverity;

    /**
     * The CVSS Score
     */
    @ApiModelProperty(value = "The vulnerability CVSS score", required = false)
    private Float cvssScore;

    /**
     * The CVSS Access Vector.
     */
    @ApiModelProperty(value = "The vulnerability CVSS access vector", required = false)
    private String cvssAccessVector;

    /**
     * The CVSS Access Complexity.
     */
    @ApiModelProperty(value = "The vulnerability CVSS access complexity", required = false)
    private String cvssAccessComplexity;

    /**
     * The CVSS Authentication.
     */
    @ApiModelProperty(value = "The vulnerability CVSS authentication", required = false)
    private String cvssAuthentication;

    /**
     * The CVSS Confidentiality Impact.
     */
    @ApiModelProperty(value = "The vulnerability CVSS confidenciality impact", required = false)
    private String cvssConfidentialityImpact;

    /**
     * The CVSS Integrity Impact.
     */
    @ApiModelProperty(value = "The vulnerability CVSS integrity impact", required = false)
    private String cvssIntegrityImpact;

    /**
     * The CVSS Availability Impact.
     */
    @ApiModelProperty(value = "The vulnerability CVSS availability impact", required = false)
    private String cvssAvailabilityImpact;

    /**
     * The CPE id that caused this vulnerability to be flagged.
     */
    @ApiModelProperty(value = "The CPE that caused this vulnerability to be flagged", required = false)
    private String matchedCPE;

    /**
     * Whether or not all previous versions were affected.
     */
    @ApiModelProperty(value = "If all the previous versions were affected", required = false)
    private String matchedAllPreviousCPE;

    /**
     * Notes about the vulnerability. Generally used for suppression information.
     */
    @ApiModelProperty(value = "Notes about the vulnerability", required = false)
    private String notes;

    /**
     * The project affected by this vulnerability
     */
    @ApiModelProperty(value = "The id of the project that contains this vulnerability", required = false)
    @ManyToOne
    @JoinColumn(name = "project_id", nullable = false)
    @JsonBackReference
    private Project project;

    /**
     * @return the cve
     */
    public String getCve() {
        return this.cve;
    }

    /**
     * @param cve the cve to set
     */
    public void setCve(final String cve) {
        this.cve = cve;
    }

    /**
     * @return the name
     */
    public String getName() {
        return this.name;
    }

    /**
     * @param name the name to set
     */
    public void setName(final String name) {
        this.name = name;
    }

    /**
     * @return the description
     */
    public String getDescription() {
        return this.description;
    }

    /**
     * @param description the description to set
     */
    public void setDescription(final String description) {
        this.description = description;
    }

    /**
     * @return the cwe
     */
    public String getCwe() {
        return this.cwe;
    }

    /**
     * @param cwe the cwe to set
     */
    public void setCwe(final String cwe) {
        this.cwe = cwe;
    }

    /**
     * @return the unscoredSeverity
     */
    public String getUnscoredSeverity() {
        return this.unscoredSeverity;
    }

    /**
     * @param unscoredSeverity the unscoredSeverity to set
     */
    public void setUnscoredSeverity(final String unscoredSeverity) {
        this.unscoredSeverity = unscoredSeverity;
    }

    /**
     * @return the cvssScore
     */
    public Float getCvssScore() {
        return this.cvssScore;
    }

    /**
     * @param cvssScore the cvssScore to set
     */
    public void setCvssScore(final Float cvssScore) {
        this.cvssScore = cvssScore;
    }

    /**
     * @return the cvssAccessVector
     */
    public String getCvssAccessVector() {
        return this.cvssAccessVector;
    }

    /**
     * @param cvssAccessVector the cvssAccessVector to set
     */
    public void setCvssAccessVector(final String cvssAccessVector) {
        this.cvssAccessVector = cvssAccessVector;
    }

    /**
     * @return the cvssAccessComplexity
     */
    public String getCvssAccessComplexity() {
        return this.cvssAccessComplexity;
    }

    /**
     * @param cvssAccessComplexity the cvssAccessComplexity to set
     */
    public void setCvssAccessComplexity(final String cvssAccessComplexity) {
        this.cvssAccessComplexity = cvssAccessComplexity;
    }

    /**
     * @return the cvssAuthentication
     */
    public String getCvssAuthentication() {
        return this.cvssAuthentication;
    }

    /**
     * @param cvssAuthentication the cvssAuthentication to set
     */
    public void setCvssAuthentication(final String cvssAuthentication) {
        this.cvssAuthentication = cvssAuthentication;
    }

    /**
     * @return the cvssConfidentialityImpact
     */
    public String getCvssConfidentialityImpact() {
        return this.cvssConfidentialityImpact;
    }

    /**
     * @param cvssConfidentialityImpact the cvssConfidentialityImpact to set
     */
    public void setCvssConfidentialityImpact(final String cvssConfidentialityImpact) {
        this.cvssConfidentialityImpact = cvssConfidentialityImpact;
    }

    /**
     * @return the cvssIntegrityImpact
     */
    public String getCvssIntegrityImpact() {
        return this.cvssIntegrityImpact;
    }

    /**
     * @param cvssIntegrityImpact the cvssIntegrityImpact to set
     */
    public void setCvssIntegrityImpact(final String cvssIntegrityImpact) {
        this.cvssIntegrityImpact = cvssIntegrityImpact;
    }

    /**
     * @return the cvssAvailabilityImpact
     */
    public String getCvssAvailabilityImpact() {
        return this.cvssAvailabilityImpact;
    }

    /**
     * @param cvssAvailabilityImpact the cvssAvailabilityImpact to set
     */
    public void setCvssAvailabilityImpact(final String cvssAvailabilityImpact) {
        this.cvssAvailabilityImpact = cvssAvailabilityImpact;
    }

    /**
     * @return the matchedCPE
     */
    public String getMatchedCPE() {
        return this.matchedCPE;
    }

    /**
     * @param matchedCPE the matchedCPE to set
     */
    public void setMatchedCPE(final String matchedCPE) {
        this.matchedCPE = matchedCPE;
    }

    /**
     * @return the matchedAllPreviousCPE
     */
    public String getMatchedAllPreviousCPE() {
        return this.matchedAllPreviousCPE;
    }

    /**
     * @param matchedAllPreviousCPE the matchedAllPreviousCPE to set
     */
    public void setMatchedAllPreviousCPE(final String matchedAllPreviousCPE) {
        this.matchedAllPreviousCPE = matchedAllPreviousCPE;
    }

    /**
     * @return the notes
     */
    public String getNotes() {
        return this.notes;
    }

    /**
     * @param notes the notes to set
     */
    public void setNotes(final String notes) {
        this.notes = notes;
    }

    /**
     * @return the project
     */
    public Project getProject() {
        return this.project;
    }

    /**
     * @param project the project to set
     */
    public void setProject(final Project project) {
        this.project = project;
    }

    // Equals and Hashcode ----------------------------------------------------
    @Override
    public String toString() {
        return String.format("%s[id= %d, cve=%s, version=%d]", this.getClass().getSimpleName(), this.getId(), this.cve,
                this.getVersion());
    }

    @Override
    public boolean equals(final Object other) {
        boolean result;

        if (this == other) {
            result = true;
        } else if (other == null) {
            result = false;
        } else if (other instanceof Long) {
            result = this.getCve().equals(other);
        } else if (!this.getClass().isInstance(other)) {
            result = false;
        } else if ((this.getId() != null) && (((Vulnerability) other).getId() != null)) {
            result = this.getId().equals(((Vulnerability) other).getId());
        } else if (this.getCve() != null) {
            result = this.getCve().equals(((Vulnerability) other).getCve());
        } else {
            result = false;
        }

        return result;
    }

}
