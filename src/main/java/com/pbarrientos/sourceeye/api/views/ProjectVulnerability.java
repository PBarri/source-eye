package com.pbarrientos.sourceeye.api.views;

import java.util.ArrayList;
import java.util.List;

import org.springframework.util.CollectionUtils;

import com.pbarrientos.sourceeye.api.StatController;
import com.pbarrientos.sourceeye.data.model.Project;
import com.pbarrientos.sourceeye.data.model.Vulnerability;
import com.pbarrientos.sourceeye.utils.ScoreRanges;

/**
 * Data Transfer Object model to support the {@link StatController}
 *
 * @author Pablo Barrientos
 */
public class ProjectVulnerability {

    /**
     * The id of the project
     */
    private Long id;

    /**
     * The name of the project
     */
    private String name;

    /**
     * The number of critical vulnerabilities found
     */
    private int criticalVulnerabilitiesCount;

    /**
     * A list with the CVEs of the critical vulnerabilities found
     */
    private List<String> criticalVulnerabilitiesCves;

    /**
     * The number of high vulnerabilities found
     */
    private int highVulnerabilitiesCount;

    /**
     * A list with the CVEs of the high vulnerabilities found
     */
    private List<String> highVulnerabilitiesCves;

    /**
     * The number of medium vulnerabilities found
     */
    private int mediumVulnerabilitiesCount;

    /**
     * A list with the CVEs of the medium vulnerabilities found
     */
    private List<String> mediumVulnerabilitiesCves;

    /**
     * The number of low vulnerabilities found
     */
    private int lowVulnerabilitiesCount;

    /**
     * A list with the CVEs of the low vulnerabilities found
     */
    private List<String> lowVulnerabilitiesCves;

    /**
     * Private constructor from a {@link Project} that generates the necessary data for filling the fields in this DTO.
     *
     * @param project the project
     */
    private ProjectVulnerability(final Project project) {
        this.id = project.getId();
        this.name = project.getName();
        this.criticalVulnerabilitiesCves = new ArrayList<>();
        this.highVulnerabilitiesCves = new ArrayList<>();
        this.mediumVulnerabilitiesCves = new ArrayList<>();
        this.lowVulnerabilitiesCves = new ArrayList<>();

        if (!CollectionUtils.isEmpty(project.getVulnerabilities())) {
            for (Vulnerability v : project.getVulnerabilities()) {
                if (ScoreRanges.LOW.getRange().contains(v.getCvssScore())) {
                    this.lowVulnerabilitiesCount++;
                    this.lowVulnerabilitiesCves.add(v.getCve());
                } else if (ScoreRanges.MEDIUM.getRange().contains(v.getCvssScore())) {
                    this.mediumVulnerabilitiesCount++;
                    this.mediumVulnerabilitiesCves.add(v.getCve());
                } else if (ScoreRanges.HIGH.getRange().contains(v.getCvssScore())) {
                    this.highVulnerabilitiesCount++;
                    this.highVulnerabilitiesCves.add(v.getCve());
                } else if (ScoreRanges.CRITICAL.getRange().contains(v.getCvssScore())) {
                    this.criticalVulnerabilitiesCount++;
                    this.criticalVulnerabilitiesCves.add(v.getCve());
                }
            }
        }
    }

    /**
     * Static method that initializes this class from a {@link Project}
     *
     * @param project the project to extract stats
     * @return an instance of {@link ProjectVulnerability}
     */
    public static ProjectVulnerability createFromProject(final Project project) {
        return new ProjectVulnerability(project);
    }

    /**
     * @return the id
     */
    public Long getId() {
        return this.id;
    }

    /**
     * @param id the id to set
     */
    public void setId(final Long id) {
        this.id = id;
    }

    /**
     * @return the name
     */
    public String getName() {
        return this.name;
    }

    /**
     * @param name the name to set
     */
    public void setName(final String name) {
        this.name = name;
    }

    /**
     * @return the criticalVulnerabilitiesCount
     */
    public int getCriticalVulnerabilitiesCount() {
        return this.criticalVulnerabilitiesCount;
    }

    /**
     * @param criticalVulnerabilitiesCount the criticalVulnerabilitiesCount to set
     */
    public void setCriticalVulnerabilitiesCount(final int criticalVulnerabilitiesCount) {
        this.criticalVulnerabilitiesCount = criticalVulnerabilitiesCount;
    }

    /**
     * @return the criticalVulnerabilitiesCves
     */
    public List<String> getCriticalVulnerabilitiesCves() {
        return this.criticalVulnerabilitiesCves;
    }

    /**
     * @param criticalVulnerabilitiesCves the criticalVulnerabilitiesCves to set
     */
    public void setCriticalVulnerabilitiesCves(final List<String> criticalVulnerabilitiesCves) {
        this.criticalVulnerabilitiesCves = criticalVulnerabilitiesCves;
    }

    /**
     * @return the highVulnerabilitiesCount
     */
    public int getHighVulnerabilitiesCount() {
        return this.highVulnerabilitiesCount;
    }

    /**
     * @param highVulnerabilitiesCount the highVulnerabilitiesCount to set
     */
    public void setHighVulnerabilitiesCount(final int highVulnerabilitiesCount) {
        this.highVulnerabilitiesCount = highVulnerabilitiesCount;
    }

    /**
     * @return the highVulnerabilitiesCves
     */
    public List<String> getHighVulnerabilitiesCves() {
        return this.highVulnerabilitiesCves;
    }

    /**
     * @param highVulnerabilitiesCves the highVulnerabilitiesCves to set
     */
    public void setHighVulnerabilitiesCves(final List<String> highVulnerabilitiesCves) {
        this.highVulnerabilitiesCves = highVulnerabilitiesCves;
    }

    /**
     * @return the mediumVulnerabilitiesCount
     */
    public int getMediumVulnerabilitiesCount() {
        return this.mediumVulnerabilitiesCount;
    }

    /**
     * @param mediumVulnerabilitiesCount the mediumVulnerabilitiesCount to set
     */
    public void setMediumVulnerabilitiesCount(final int mediumVulnerabilitiesCount) {
        this.mediumVulnerabilitiesCount = mediumVulnerabilitiesCount;
    }

    /**
     * @return the mediumVulnerabilitiesCves
     */
    public List<String> getMediumVulnerabilitiesCves() {
        return this.mediumVulnerabilitiesCves;
    }

    /**
     * @param mediumVulnerabilitiesCves the mediumVulnerabilitiesCves to set
     */
    public void setMediumVulnerabilitiesCves(final List<String> mediumVulnerabilitiesCves) {
        this.mediumVulnerabilitiesCves = mediumVulnerabilitiesCves;
    }

    /**
     * @return the lowVulnerabilitiesCount
     */
    public int getLowVulnerabilitiesCount() {
        return this.lowVulnerabilitiesCount;
    }

    /**
     * @param lowVulnerabilitiesCount the lowVulnerabilitiesCount to set
     */
    public void setLowVulnerabilitiesCount(final int lowVulnerabilitiesCount) {
        this.lowVulnerabilitiesCount = lowVulnerabilitiesCount;
    }

    /**
     * @return the lowVulnerabilitiesCves
     */
    public List<String> getLowVulnerabilitiesCves() {
        return this.lowVulnerabilitiesCves;
    }

    /**
     * @param lowVulnerabilitiesCves the lowVulnerabilitiesCves to set
     */
    public void setLowVulnerabilitiesCves(final List<String> lowVulnerabilitiesCves) {
        this.lowVulnerabilitiesCves = lowVulnerabilitiesCves;
    }

}
